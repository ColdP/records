<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿå®‰å…¨è­¦ç¤º - è¿æ³•æ“ä½œè¢«é”å®š</title>
    <!-- å¼•å…¥ Material Symbols å›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <!-- å¼•å…¥ Google Fonts (Noto Sans SC & Roboto Mono for logs) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&family=Roboto+Mono:wght@400&display=swap" rel="stylesheet">
    <!-- å¼•å…¥ QRCode.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        :root {
            /* Material 3 Color Tokens - Error/Expressive Theme */
            --md-sys-color-surface: #FFF8F6;
            --md-sys-color-surface-container: #FFFFFF;
            --md-sys-color-on-surface: #201A19;
            --md-sys-color-primary: #9C4146;
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-primary-container: #FFDAD9;
            --md-sys-color-on-primary-container: #40000A;
            --md-sys-color-error: #BA1A1A;
            --md-sys-color-outline: #857372;
            
            /* Coupon Colors */
            --coupon-national: #E2483D;
            --coupon-province: #F19E39;
            --coupon-billions: #D92027;

            /* Spacing & Radius */
            --radius-xl: 28px;
            --radius-m: 16px;
            --radius-s: 12px;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            font-family: 'Noto Sans SC', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* æ¨¡ç³ŠèƒŒæ™¯å±‚ */
        .background-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(var(--md-sys-color-primary-container) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.5;
            z-index: -1;
        }

        /* ä¸»å¡ç‰‡å®¹å™¨ */
        .alert-card {
            background: var(--md-sys-color-surface-container);
            width: 90%;
            max-width: 420px;
            border-radius: var(--radius-xl);
            box-shadow: 0 25px 50px -12px rgba(156, 65, 70, 0.25);
            padding: 32px 24px;
            text-align: center;
            position: relative;
            border: 1px solid rgba(186, 26, 26, 0.1);
            animation: popIn 0.6s cubic-bezier(0.19, 1, 0.22, 1);
        }

        @keyframes popIn {
            0% { transform: scale(0.9) translateY(20px); opacity: 0; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }

        /* å›¾æ ‡åŠ¨ç”» */
        .lock-icon-container {
            width: 80px;
            height: 80px;
            background: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            animation: shake 0.8s ease-in-out infinite;
            cursor: pointer; /* å¢åŠ æ‰‹å‹å…‰æ ‡æç¤ºå¯ç‚¹å‡» */
            user-select: none;
        }

        .material-symbols-outlined {
            font-size: 40px;
        }

        @keyframes shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
        }

        h1 {
            font-size: 24px;
            font-weight: 900;
            margin: 0 0 8px 0;
            color: var(--md-sys-color-error);
        }

        .subtitle {
            font-size: 14px;
            color: var(--md-sys-color-outline);
            margin-bottom: 24px;
            font-family: monospace;
            background: rgba(0,0,0,0.03);
            display: inline-block;
            padding: 4px 12px;
            border-radius: 8px;
        }

        /* è´¦å•æ˜ç»†åŒºåŸŸ */
        .bill-details {
            background: #FFF0EE;
            border-radius: var(--radius-m);
            padding: 20px;
            margin-bottom: 24px;
            text-align: left;
        }

        .bill-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
            align-items: center;
        }

        .price-original {
            text-decoration: line-through;
            color: var(--md-sys-color-outline);
        }

        /* ä¼˜æƒ æ ‡ç­¾æ ·å¼ */
        .subsidy-tag {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            margin-right: 8px;
            display: inline-flex;
            align-items: center;
        }

        .tag-national { background: linear-gradient(135deg, #FF6B6B, #E2483D); }
        .tag-province { background: linear-gradient(135deg, #FFC069, #F19E39); }
        .tag-billions { background: linear-gradient(135deg, #FF4D4F, #D92027); box-shadow: 0 2px 4px rgba(217, 32, 39, 0.3); }

        .discount-text {
            color: var(--md-sys-color-error);
            font-weight: bold;
        }

        .divider {
            height: 1px;
            background: rgba(0,0,0,0.1);
            margin: 16px 0;
            border-bottom: 1px dashed rgba(0,0,0,0.2);
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-top: 10px;
        }

        .total-label {
            font-weight: bold;
            color: var(--md-sys-color-on-surface);
        }

        .total-price {
            font-size: 32px;
            font-weight: 900;
            color: var(--md-sys-color-error);
            line-height: 1;
        }

        .total-price span {
            font-size: 16px;
            margin-right: 2px;
        }

        /* æŒ‰é’® */
        .pay-btn {
            background: var(--md-sys-color-error);
            color: white;
            border: none;
            width: 100%;
            padding: 18px;
            border-radius: 100px;
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(186, 26, 26, 0.3);
        }

        .pay-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(186, 26, 26, 0.4);
        }

        .pay-btn:active {
            transform: scale(0.98);
        }

        /* æ¨¡æ€æ¡† (Dialog) */
        dialog {
            border: none;
            border-radius: var(--radius-xl);
            padding: 32px;
            background: white;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 320px;
            width: 100%;
            text-align: center;
        }

        dialog::backdrop {
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
        }

        dialog h2 {
            margin-top: 0;
            color: var(--md-sys-color-on-surface);
        }

        /* ä¿®æ”¹ï¼šé’ˆå¯¹ QRCode.js ç”Ÿæˆçš„å®¹å™¨å’Œå›¾ç‰‡æ ·å¼ */
        #qr-code-container {
            margin: 16px auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #qr-code-container img {
            border-radius: 12px;
            border: 4px solid var(--md-sys-color-primary-container);
            padding: 5px; /* å¢åŠ ä¸€ç‚¹å†…è¾¹è·è®©äºŒç»´ç ä¸è´´è¾¹ */
            background: white;
        }

        .close-btn {
            background: transparent;
            border: 1px solid var(--md-sys-color-outline);
            color: var(--md-sys-color-on-surface);
            padding: 10px 24px;
            border-radius: 100px;
            cursor: pointer;
            font-weight: 500;
            margin-top: 16px;
        }
        
        .close-btn:hover {
            background: rgba(0,0,0,0.05);
        }

        /* åº•éƒ¨æ³•å¾‹å£°æ˜ */
        .footer-text {
            font-size: 11px;
            color: var(--md-sys-color-outline);
            margin-top: 24px;
            line-height: 1.5;
        }

        /* ------------------------
           é€šç”¨æ­»æœºå±‚ (BSOD / Kernel Panic)
           ------------------------ */
        #bsod {
            display: none; /* é»˜è®¤éšè— */
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 99999;
            cursor: none; /* éšè—é¼ æ ‡ */
            box-sizing: border-box;
            overflow: hidden;
        }

        /* Windows 10 (ç»å…¸è“) */
        .bsod-win10 {
            background-color: #0078D7;
            color: white;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            padding: 10% 15%;
            text-align: left;
        }

        /* Windows 11 (é»‘å±ç‰ˆæœ¬) */
        .bsod-win11 {
            background-color: #000000;
            color: white;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            padding: 10% 15%;
            text-align: left;
        }

        /* Win 10/11 é€šç”¨å†…éƒ¨å…ƒç´  */
        .bsod-win-sad-face { font-size: 10rem; margin-bottom: 2rem; font-weight: 300; }
        .bsod-win-message { font-size: 1.8rem; line-height: 1.4; margin-bottom: 2rem; font-weight: 300; }
        .bsod-win-percent { font-size: 1.8rem; margin-bottom: 3rem; font-weight: 300; }
        .bsod-win-details { display: flex; align-items: flex-start; font-size: 0.9rem; line-height: 1.6; }
        .bsod-win-qr { background: white; padding: 5px; margin-right: 20px; }
        .bsod-win-qr img { width: 100px; height: 100px; }

        /* macOS (Kernel Panic) */
        .bsod-mac {
            background-color: #202020;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .bsod-mac-content {
            background: rgba(0,0,0,0.5);
            padding: 40px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            max-width: 600px;
        }
        .bsod-mac-icon { font-size: 64px; margin-bottom: 24px; color: #ddd; }
        .bsod-mac-text { font-size: 18px; line-height: 1.6; margin-bottom: 16px; font-weight: 500; }
        
        /* Linux (Kernel Panic) */
        .bsod-linux {
            background-color: #000000;
            color: #AAAAAA;
            font-family: 'Roboto Mono', monospace;
            padding: 20px;
            font-size: 14px;
            line-height: 1.2;
            text-align: left;
            white-space: pre-wrap;
        }
        .linux-cursor { display: inline-block; width: 8px; height: 16px; background: #AAAAAA; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        /* Android (ç³»ç»Ÿå´©æºƒå¼¹çª—) */
        .bsod-android {
            background-color: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: Roboto, sans-serif;
        }
        .android-dialog {
            background: #303030;
            color: white;
            width: 80%;
            max-width: 320px;
            padding: 24px;
            border-radius: 28px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .android-title { font-size: 20px; font-weight: 500; margin-bottom: 12px; }
        .android-msg { font-size: 14px; color: #ccc; margin-bottom: 24px; line-height: 1.5; }
        .android-btn { color: #A8C7FA; font-weight: 500; text-align: right; cursor: pointer; float: right; }

        /* iOS (é»‘å±è½¬åœˆ) */
        .bsod-ios {
            background-color: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .ios-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ------------------------
           Debug Menu Styles
           ------------------------ */
        #debug-menu {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            color: #333;
            width: 90%;
            max-width: 340px;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            z-index: 1000000;
            font-family: 'Noto Sans SC', sans-serif;
            text-align: left;
            border: 1px solid #eee;
        }
        #debug-menu h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: var(--md-sys-color-primary);
            font-size: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .debug-section {
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        .debug-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .debug-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 6px;
            display: block;
        }
        .debug-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 8px;
            box-sizing: border-box;
            font-family: inherit;
        }
        .debug-btn-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        .debug-btn {
            background: #f0f0f0;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
            text-align: center;
        }
        .debug-btn:hover { background: #e0e0e0; }
        .debug-btn.primary {
            background: var(--md-sys-color-primary);
            color: white;
            width: 100%;
        }
        .debug-btn.close {
            background: transparent;
            color: #999;
            font-size: 20px;
            padding: 0;
            width: auto;
        }
        .debug-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999999;
        }

    </style>
</head>
<body>

    <div class="background-pattern"></div>

    <main class="alert-card">
        <!-- é”å¤´å›¾æ ‡ï¼šè¿ç»­ç‚¹å‡»5æ¬¡è§¦å‘Debug -->
        <div class="lock-icon-container" id="lockTrigger">
            <span class="material-symbols-outlined">lock</span>
        </div>

        <h1>è®¾å¤‡å·²è¢«é”å®š</h1>
        <div class="subtitle">æ¡ˆä»¶ç¼–å·ï¼š114-514-1919-810</div>
        
        <p style="font-size: 14px; margin-bottom: 24px; color: #4a4544;">
            æ£€æµ‹åˆ°æ‚¨çš„è®¾å¤‡æµè§ˆäº†<strong>å¤§é‡è¿è§„å†…å®¹</strong>ã€‚æ ¹æ®ã€Šäº’è”ç½‘å†²æµªå®‰å…¨æ³•ã€‹ç¬¬114æ¡ï¼Œæ‚¨çš„è®¾å¤‡å·²è¢«é”æ­»ï¼Œè¯·ç«‹å³ç¼´çº³ç½šæ¬¾ä»¥è§£é”ã€‚
        </p>

        <div class="bill-details">
            <div class="bill-row">
                <span>åŸºç¡€ç½šé‡‘</span>
                <span class="price-original">Â¥2500.00</span>
            </div>
            
            <div class="bill-row">
                <span><span class="subsidy-tag tag-national">å›½è¡¥</span>å›½å®¶å®‰å…¨è¡¥è´´</span>
                <span class="discount-text">-Â¥500</span>
            </div>
            
            <div class="bill-row">
                <span><span class="subsidy-tag tag-province">çœè¡¥</span>çœå¿ƒçœåŠ›è¡¥è´´</span>
                <span class="discount-text">-Â¥500</span>
            </div>

            <div class="bill-row">
                <span><span class="subsidy-tag tag-billions">ç™¾äº¿è¡¥è´´</span>å¹³å°æ•´æ”¹ä¸“äº«</span>
                <span class="discount-text">-Â¥801</span>
            </div>

            <div class="divider"></div>

            <div class="total-row">
                <span class="total-label">å®ä»˜é‡‘é¢</span>
                <span class="total-price"><span>Â¥</span>699</span>
            </div>
        </div>

        <button class="pay-btn" id="openDialog">
            <span class="material-symbols-outlined">qr_code_scanner</span>
            ç«‹å³ç¼´çº³ç½šæ¬¾
        </button>

        <div class="footer-text">
            æ³¨æ„ï¼šä¸ç¼´çº³ç½šæ¬¾å°†å¯¼è‡´ç”µè„‘æ°¸ä¹…æ’­æ”¾ã€Šå¸Œæœ›ä¹‹èŠ±ã€‹ã€‚<br>
            è§£é‡Šæƒå½’ 114514 å·ç½‘ç»œå®‰å…¨ä¸­å¿ƒæ‰€æœ‰ã€‚
        </div>
    </main>

    <!-- å¼¹çª— -->
    <dialog id="paymentDialog">
        <h2>æ‰«ç è®¤ç½š</h2>
        <p style="color: #666; font-size: 14px;">è¯·ä½¿ç”¨æ‰‹æœºæ‰«ç æ”¯ä»˜</p>
        
        <!-- ä½¿ç”¨ div ä½œä¸º QRCode.js çš„å®¹å™¨ -->
        <div id="qr-code-container"></div>
        
        <p style="font-size: 12px; color: #999;">æ”¯æŒ å¾®ä¿¡ / æ”¯ä»˜å® / äº‘é—ªä»˜</p>
        
        <!-- å–æ¶ˆæŒ‰é’® -->
        <button class="close-btn" id="cancelBtn">å–æ¶ˆ</button>
    </dialog>

    <!-- è“å±/æ­»æœºç•Œé¢å®¹å™¨ (å†…å®¹ç”± JS åŠ¨æ€ç”Ÿæˆ) -->
    <div id="bsod"></div>

    <!-- Debug èœå•é®ç½© -->
    <div id="debugBackdrop" class="debug-backdrop"></div>

    <!-- Debug èœå• -->
    <div id="debug-menu">
        <h3>
            <span>ğŸ› ï¸ å¼€å‘è€…åå°</span>
            <button class="debug-btn close" id="closeDebug">Ã—</button>
        </h3>
        
        <div class="debug-section">
            <label class="debug-label">è‡ªå®šä¹‰å¼¹çª—äºŒç»´ç å†…å®¹ (æ”¯ä»˜ç )</label>
            <input type="text" id="debugQrText" class="debug-input" value="ä½ è¢«è€äº†">
            
            <label class="debug-label">è‡ªå®šä¹‰è“å±äºŒç»´ç å†…å®¹ (RickRoll)</label>
            <input type="text" id="debugBsodUrl" class="debug-input" value="https://www.bilibili.com/video/BV1GJ411x7h7">
            
            <button class="debug-btn primary" id="applyDebug">åº”ç”¨æ›´æ”¹</button>
        </div>

        <div class="debug-section">
            <label class="debug-label">å¼ºåˆ¶é¢„è§ˆæ­»æœºç•Œé¢</label>
            <div class="debug-btn-grid">
                <button class="debug-btn" data-os="win10">Windows 10</button>
                <button class="debug-btn" data-os="win11">Windows 11</button>
                <button class="debug-btn" data-os="mac">macOS</button>
                <button class="debug-btn" data-os="linux">Linux</button>
                <button class="debug-btn" data-os="android">Android</button>
                <button class="debug-btn" data-os="ios">iOS</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const dialog = document.getElementById('paymentDialog');
            const openBtn = document.getElementById('openDialog');
            const cancelBtn = document.getElementById('cancelBtn'); 
            const bsodLayer = document.getElementById('bsod');
            
            // å˜é‡å­˜å‚¨å½“å‰äºŒç»´ç å†…å®¹
            let currentQrText = "ä½ è¢«è€äº†";
            let currentBsodUrl = "https://www.bilibili.com/video/BV1GJ411x7h7";

            // åˆå§‹åŒ–å¼¹çª—å†…çš„äºŒç»´ç å‡½æ•°
            function renderMainQR() {
                const container = document.getElementById("qr-code-container");
                container.innerHTML = ''; // æ¸…ç©ºæ—§çš„
                new QRCode(container, {
                    text: currentQrText,
                    width: 200,
                    height: 200,
                    colorDark : "#BA1A1A", 
                    colorLight : "#FFFFFF",
                    correctLevel : QRCode.CorrectLevel.H
                });
            }

            // åˆå§‹æ¸²æŸ“
            renderMainQR();

            // æ‰“å¼€å¼¹çª—
            openBtn.addEventListener('click', () => {
                dialog.showModal();
            });

            // ç‚¹å‡»â€œå–æ¶ˆâ€æŒ‰é’®è§¦å‘æ­»æœºæ•ˆæœ
            cancelBtn.addEventListener('click', () => {
                dialog.close();
                toggleFullScreen();
                triggerCrash(); // è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿè§¦å‘
            });

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            dialog.addEventListener('click', (e) => {
                const dialogDimensions = dialog.getBoundingClientRect();
                if (
                    e.clientX < dialogDimensions.left ||
                    e.clientX > dialogDimensions.right ||
                    e.clientY < dialogDimensions.top ||
                    e.clientY > dialogDimensions.bottom
                ) {
                    dialog.close();
                }
            });

            // å…¨å±
            function toggleFullScreen() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log(`Error attempting to enable full-screen mode: ${err.message}`);
                    });
                }
            }

            // è·å–æ“ä½œç³»ç»Ÿ
            function getOS() {
                const userAgent = window.navigator.userAgent;
                const platform = window.navigator.platform;
                const macosPlatforms = ['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'];
                const windowsPlatforms = ['Win32', 'Win64', 'Windows', 'WinCE'];
                const iosPlatforms = ['iPhone', 'iPad', 'iPod'];
                let os = null;

                if (macosPlatforms.indexOf(platform) !== -1) {
                    os = 'macOS';
                } else if (iosPlatforms.indexOf(platform) !== -1 || /iPhone|iPad|iPod/.test(userAgent)) {
                    os = 'iOS';
                } else if (windowsPlatforms.indexOf(platform) !== -1) {
                    os = Math.random() > 0.5 ? 'Windows 11' : 'Windows 10'; 
                } else if (/Android/.test(userAgent)) {
                    os = 'Android';
                } else if (!os && /Linux/.test(platform)) {
                    os = 'Linux';
                }
                return os || 'Windows 11';
            }

            // è§¦å‘æ­»æœºç”»é¢ (è‡ªåŠ¨)
            function triggerCrash() {
                const os = getOS();
                triggerSpecificCrash(os);
            }

            // è§¦å‘ç‰¹å®šæ­»æœºç”»é¢
            function triggerSpecificCrash(osType) {
                bsodLayer.style.display = 'block'; 
                bsodLayer.innerHTML = ''; 
                bsodLayer.className = ''; 

                if (osType === 'Windows 10' || osType === 'win10') {
                    renderWindowsBSOD(false); 
                } else if (osType === 'Windows 11' || osType === 'win11') {
                    renderWindowsBSOD(true); 
                } else if (osType === 'macOS' || osType === 'mac') {
                    renderMacOSPanic();
                } else if (osType === 'Linux' || osType === 'linux') {
                    renderLinuxPanic();
                } else if (osType === 'Android' || osType === 'android') {
                    renderAndroidCrash();
                } else if (osType === 'iOS' || osType === 'ios') {
                    renderIOSCrash();
                } else {
                    renderWindowsBSOD(true);
                }
            }

            /* =========================================
               æ¸²æŸ“å‡½æ•° (Windows, Mac, Linux, etc.)
               ========================================= */

            function renderWindowsBSOD(isBlack) {
                bsodLayer.classList.add(isBlack ? 'bsod-win11' : 'bsod-win10');
                bsodLayer.innerHTML = `
                    <div class="bsod-win-sad-face">:(</div>
                    <div class="bsod-win-message">
                        ä½ çš„ç”µè„‘é‡åˆ°é—®é¢˜ï¼Œéœ€è¦é‡æ–°å¯åŠ¨ã€‚<br>
                        æˆ‘ä»¬åªæ”¶é›†æŸäº›é”™è¯¯ä¿¡æ¯ï¼Œç„¶åä½ å¯ä»¥é‡æ–°å¯åŠ¨ã€‚
                    </div>
                    <div class="bsod-win-percent">
                        <span id="bsod-percent">0</span>% å®Œæˆ
                    </div>
                    <div class="bsod-win-details">
                        <div id="bsod-qr-placeholder" class="bsod-win-qr"></div>
                        <div class="info-text">
                            <p style="margin: 0;">
                                å…³äºæ­¤é—®é¢˜çš„è¯¦ç»†ä¿¡æ¯å’Œå¯èƒ½çš„è§£å†³æ–¹æ³•ï¼Œè¯·è®¿é—®<br>
                                https://www.windows.com/stopcode
                            </p>
                            <div class="stop-code" style="margin-top:10px; font-size:0.8rem;">
                                å¦‚æœæ˜¯è‡´ç”µæ”¯æŒäººå‘˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š<br>
                                ç»ˆæ­¢ä»£ç : CRITICAL_PROCESS_DIED
                            </div>
                        </div>
                    </div>
                `;
                
                new QRCode(document.getElementById("bsod-qr-placeholder"), {
                    text: currentBsodUrl,
                    width: 100,
                    height: 100,
                    colorDark : isBlack ? "#000000" : "#00204a",
                    colorLight : "#FFFFFF",
                    correctLevel : QRCode.CorrectLevel.M
                });

                startProgress();
            }

            function renderMacOSPanic() {
                bsodLayer.classList.add('bsod-mac');
                bsodLayer.innerHTML = `
                    <div class="bsod-mac-content">
                        <span class="material-symbols-outlined bsod-mac-icon">power_settings_new</span>
                        <div class="bsod-mac-text">
                            You need to restart your computer. Hold down the Power button for several seconds or press the Restart button.
                        </div>
                        <div class="bsod-mac-text">
                            æ‚¨çš„ç”µè„‘éœ€è¦é‡æ–°å¯åŠ¨ã€‚è¯·æŒ‰ä½ç”µæºæŒ‰é’®å‡ ç§’é’Ÿæˆ–æŒ‰â€œé‡æ–°å¯åŠ¨â€æŒ‰é’®ã€‚
                        </div>
                        <div class="bsod-mac-text">
                            Veuillez redÃ©marrer votre ordinateur. Maintenez la touche de dÃ©marrage enfoncÃ©e pendant plusieurs secondes ou bien appuyez sur le bouton de rÃ©initialisation.
                        </div>
                        <div class="bsod-mac-text">
                            ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚’å†èµ·å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãƒ‘ãƒ¯ãƒ¼ãƒœã‚¿ãƒ³ã‚’æ•°ç§’é–“æŠ¼ã—ç¶šã‘ã‚‹ã‹ã€ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
                        </div>
                    </div>
                `;
            }

            function renderLinuxPanic() {
                bsodLayer.classList.add('bsod-linux');
                bsodLayer.innerHTML = `
                    <div>[    0.000000] Linux version 5.15.0-58-generic (buildd@lcy02-amd64-101) (gcc (Ubuntu 11.3.0-1ubuntu1~22.04) 11.3.0, GNU ld (GNU Binutils for Ubuntu) 2.38) #64-Ubuntu SMP Thu Jan 5 11:43:13 UTC 2023</div>
                    <div>[    0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-5.15.0-58-generic root=UUID=1a2b3c4d-5e6f-7g8h-9i0j-k1l2m3n4o5p6 ro quiet splash vt.handoff=7</div>
                    <div>[    0.283192] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</div>
                    <div>[    0.283254] CPU: 0 PID: 1 Comm: swapper/0 Not tainted 5.15.0-58-generic #64-Ubuntu</div>
                    <div>[    0.283301] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.13.0-1ubuntu1.1 04/01/2014</div>
                    <div>[    0.283348] Call Trace:</div>
                    <div>[    0.283389]  <TASK></div>
                    <div>[    0.283432]  dump_stack_lvl+0x45/0x5e</div>
                    <div>[    0.283478]  panic+0x11c/0x2fa</div>
                    <div>[    0.283515]  mount_block_root+0x21c/0x2c0</div>
                    <div>[    0.283561]  mount_root+0x3d/0x45</div>
                    <div>[    0.283599]  prepare_namespace+0x13f/0x18e</div>
                    <div>[    0.283642]  kernel_init_freeable+0x18a/0x1ce</div>
                    <div>[    0.283691]  ? rest_init+0x100/0x100</div>
                    <div>[    0.283731]  kernel_init+0x16/0x120</div>
                    <div>[    0.283771]  ret_from_fork+0x22/0x30</div>
                    <div>[    0.283812]  </TASK></div>
                    <div>[    0.283884] Kernel Offset: 0x22000000 from 0xffffffff81000000 (relocation range: 0xffffffff80000000-0xffffffffbfffffff)</div>
                    <div>[    0.283945] ---[ end Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0) ]---</div>
                    <div style="margin-top:10px;"><span class="linux-cursor"></span></div>
                `;
            }

            function renderAndroidCrash() {
                bsodLayer.classList.add('bsod-android');
                bsodLayer.innerHTML = `
                    <div class="android-dialog">
                        <div class="android-title">System UI isn't responding</div>
                        <div class="android-msg">
                            Process system has stopped responding to your interaction.
                        </div>
                        <div class="android-btn" onclick="location.reload()">Close app</div>
                        <div class="android-btn" style="margin-right: 20px;">Wait</div>
                    </div>
                `;
            }

            function renderIOSCrash() {
                bsodLayer.classList.add('bsod-ios');
                bsodLayer.innerHTML = `<div class="ios-spinner"></div>`;
            }

            function startProgress() {
                const percentSpan = document.getElementById('bsod-percent');
                if(!percentSpan) return;
                let progress = 0;
                const interval = setInterval(() => {
                    progress += Math.floor(Math.random() * 5); 
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(interval);
                    }
                    percentSpan.innerText = progress;
                }, 800);
            }


            /* =========================================
               Debug Menu Logic
               ========================================= */
            
            const lockTrigger = document.getElementById('lockTrigger');
            const debugMenu = document.getElementById('debug-menu');
            const debugBackdrop = document.getElementById('debugBackdrop');
            const closeDebug = document.getElementById('closeDebug');
            const applyDebug = document.getElementById('applyDebug');
            
            let clickCount = 0;
            let clickTimer;

            // 1. è¿ç»­ç‚¹å‡»è§¦å‘
            lockTrigger.addEventListener('click', () => {
                clickCount++;
                
                // ç»™ç‚¹è§†è§‰åé¦ˆ
                lockTrigger.style.transform = 'scale(0.95)';
                setTimeout(() => lockTrigger.style.transform = 'scale(1)', 100);

                // é‡ç½®è®¡æ—¶å™¨
                clearTimeout(clickTimer);
                clickTimer = setTimeout(() => {
                    clickCount = 0;
                }, 2000); // 2ç§’å†…æ²¡ç‚¹å¤Ÿæ¬¡æ•°å°±é‡ç½®

                if (clickCount >= 5) {
                    showDebugMenu();
                    clickCount = 0;
                }
            });

            function showDebugMenu() {
                debugMenu.style.display = 'block';
                debugBackdrop.style.display = 'block';
            }

            function hideDebugMenu() {
                debugMenu.style.display = 'none';
                debugBackdrop.style.display = 'none';
            }

            closeDebug.addEventListener('click', hideDebugMenu);
            debugBackdrop.addEventListener('click', hideDebugMenu);

            // 2. åº”ç”¨æ›´æ”¹ (ä¿®æ”¹äºŒç»´ç å†…å®¹)
            applyDebug.addEventListener('click', () => {
                const newQrText = document.getElementById('debugQrText').value;
                const newBsodUrl = document.getElementById('debugBsodUrl').value;
                
                if (newQrText) {
                    currentQrText = newQrText;
                    renderMainQR(); // é‡æ–°æ¸²æŸ“ä¸»ç•Œé¢äºŒç»´ç 
                }
                
                if (newBsodUrl) {
                    currentBsodUrl = newBsodUrl;
                }
                
                alert('æ›´æ”¹å·²åº”ç”¨ï¼\nå¼¹çª—å’Œæ­»æœºç•Œé¢çš„å†…å®¹å·²æ›´æ–°ã€‚');
            });

            // 3. å¼ºåˆ¶é¢„è§ˆæ­»æœºç•Œé¢
            const debugBtns = document.querySelectorAll('.debug-btn[data-os]');
            debugBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const osType = btn.getAttribute('data-os');
                    hideDebugMenu();
                    dialog.close(); // å¦‚æœå¼¹çª—å¼€ç€ï¼Œå…³æ‰
                    toggleFullScreen(); // å°è¯•å…¨å±
                    triggerSpecificCrash(osType);
                });
            });

        });
    </script>
</body>
</html>